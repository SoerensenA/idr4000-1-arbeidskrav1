---
title: "Reliability of knee-extension tests"
format: html
editor_options: 
  chunk_output_type: console
---


```{r setup, include = FALSE}
library(tidyverse)
library(readxl)
data <- read_excel("data/humac-data.xlsx") %>% 
  mutate(pt.120 = as.numeric(pt.120),
         ttp.120 = as.numeric(ttp.120),
         pt.240 = as.numeric(pt.240),
         ttp.240 = as.numeric(ttp.240),
         pt.360 = as.numeric(pt.360),
         ttp.360 = as.numeric(ttp.360),
         pt.480 = as.numeric(pt.480),
         ttp.480 = as.numeric(ttp.480),
         pt.iso = as.numeric(pt.iso),
         ttp.iso = as.numeric(ttp.iso))
```


```{r reliability}
data %>% 
  pivot_longer(names_to = "variable",
               values_to = "values",
               cols = pt.60:ttp.iso) %>% 
  pivot_wider(names_from = timepoint,
              values_from = values) %>% 
  mutate(diff = post - pre) %>% 
  group_by(leg, variable) %>% 
  summarise(m = mean(c(pre, post), na.rm = T),
            sd = sd(diff, na.rm = T),
            te = sd / sqrt(2),
            cv = 100 * (te / m),
            L = qt(0.975, 4) * sd) %>% 
  print()
  
```


